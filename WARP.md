# JS7800 é–‹ç™¼å·¥ä½œè¨˜éŒ„

## ç›®éŒ„
1. [Leaderboard åŒæ­¥å•é¡Œ](#leaderboard-åŒæ­¥å•é¡Œ)
2. [UI æ”¹é€²](#ui-æ”¹é€²-2025-10-23)
3. [å¤šèªç³»æ”¯æ´](#å¤šèªç³»æ”¯æ´-2025-10-23)

---

## Leaderboard åŒæ­¥å•é¡Œ

### âœ… å•é¡Œå®Œå…¨è§£æ±ºï¼

#### æœ€çµ‚ç‹€æ…‹
- âœ… **Leaderboard è®€å–æ­£å¸¸** - å¯ä»¥æˆåŠŸå¾åŸä½œè€…ç¶²ç«™å–å¾—é«˜åˆ†è³‡æ–™
- âœ… **é«˜åˆ†ä¿å­˜å·²åŒæ­¥** - éŠæˆ²ç ´ç´€éŒ„æ™‚ï¼Œæœ¬åœ°å’ŒåŸä½œè€…æ’è¡Œæ¦œéƒ½å¯¦æ™‚æ›´æ–°
- âœ… **æ™ºèƒ½ç·©å­˜å’Œé€Ÿç‡é™åˆ¶** - é »ç¹åˆ·æ–°ä¸æœƒè§¸ç™¼ç´…æ¡†è­¦å‘Š

#### å•é¡Œå›é¡§
##### åˆæœŸå•é¡Œ
ç•¶ç©å®¶åœ¨ https://js7800.pages.dev/ ç ´ç´€éŒ„æ™‚ï¼š
1. Console é¡¯ç¤º: `HSC Scores have changed, saving.`
2. âŒ åŸä½œè€…çš„æ’è¡Œæ¦œå»æ²’æœ‰æ›´æ–°

##### é »ç¹åˆ·æ–°å•é¡Œ
- âŒ é »ç¹åˆ·æ–°æ’è¡Œæ¦œé é¢æ™‚å‡ºç¾ç´…æ¡†è­¦å‘Š
- âŒ `SyntaxError: Unexpected token '<'` 
- âŒ Data length 288ï¼ˆHTML éŒ¯èª¤é é¢ï¼‰
- âœ… ç¾å·²è§£æ±ºï¼šä½¿ç”¨æ™ºèƒ½å¿«å–å’Œé™ç´šæ–¹æ¡ˆ

#### è§£æ±ºæ–¹æ¡ˆå¯¦è£

##### 1. POST è½‰ç™¼ï¼ˆå·²é©—è­‰âœ…ï¼‰
```
éŠæˆ²ç ´ç´€éŒ„
    â†“
Worker æ¥æ”¶ POST
    â”œâ”€ ä¿å­˜åˆ° KV
    â””â”€ proxy è½‰ç™¼åˆ° twitchasylum.com/x/save.php
    â†“
åŸä½œè€…ä¼ºæœå™¨æ›´æ–°æ’è¡Œæ¦œ âœ…
```

##### 2. æ™ºèƒ½ç·©å­˜æ©Ÿåˆ¶ âœ…
- **å¿«å–æ™‚é–“**: 30 ç§’
- **å¿«å–å°è±¡**: /games, /summary, /scores ç«¯é»
- **å¿«å–éµå€¼**: ä»¥å®Œæ•´ URL ç‚ºåŸºç¤
- **æ•ˆæœ**: æ¸›å°‘é‡è¤‡è«‹æ±‚ï¼Œæå‡é€Ÿåº¦

##### 3. é€Ÿç‡é™åˆ¶è™•ç† âœ…
- **æœ€å°è«‹æ±‚é–“éš”**: 10 ç§’
- **æª¢æ¸¬æ©Ÿåˆ¶**: è­˜åˆ¥ data length < 500 æˆ–ä»¥ `<` é–‹é ­çš„éŒ¯èª¤å›æ‡‰
- **é™ç´šæ–¹æ¡ˆ**: è¢«é™åˆ¶æ™‚è‡ªå‹•è¿”å›å¿«å–æ•¸æ“šè€Œä¸å ±éŒ¯
- **ç”¨æˆ¶é«”é©—**: é »ç¹åˆ·æ–°ä¸æœƒå‡ºç¾ç´…æ¡†è­¦å‘Š

##### 4. è©³ç´°æ—¥èªŒç³»çµ± âœ…
æ–°å¢æ—¥èªŒæ¨™ç±¤ï¼š
- `âœ… Returning cached data` - è¿”å›å¿«å–
- `â±ï¸ Rate limited, returning cached data` - è¢«é™åˆ¶ä½†æœ‰å¿«å–
- `ğŸ“¦ Using cached data as fallback` - éŒ¯èª¤æ™‚ä½¿ç”¨å¿«å–é™ç´š
- `âš ï¸ Received error response` - æª¢æ¸¬åˆ°éŒ¯èª¤å›æ‡‰

#### é©—è­‰çµæœ
âœ… ç ´ç´€éŒ„å¾Œæ’è¡Œæ¦œåŒæ­¥
âœ… é »ç¹åˆ·æ–°ç„¡è­¦å‘Š
âœ… å¿«å–æ©Ÿåˆ¶æ­£å¸¸é‹ä½œ
âœ… é™ç´šæ–¹æ¡ˆæœ‰æ•ˆ

#### é…ç½®åƒæ•¸
```javascript
const CACHE_DURATION = 30 * 1000;      // 30 ç§’å¿«å–
const MIN_REQUEST_INTERVAL = 10 * 1000; // 10 ç§’æœ€å°é–“éš”
```

#### éƒ¨ç½²ä¿¡æ¯
- **Worker ç‰ˆæœ¬**: 4.42.1+
- **æœ€å¾Œæ›´æ–°**: 2025-10-21
- **å¿«å–ç­–ç•¥**: æ™ºèƒ½è¨˜æ†¶é«”å¿«å– + é€Ÿç‡é™åˆ¶
- **é™ç´šæ©Ÿåˆ¶**: è‡ªå‹•ä½¿ç”¨éæœŸå¿«å–

---

## UI æ”¹é€² (2025-10-23)

### å•é¡Œ 1: Global Leaderboard æŒ‰éˆ•é‡è¤‡é¡¯ç¤º âœ…

#### å•é¡Œæè¿°
Global Leaderboard é é¢çš„ Play æŒ‰éˆ•å’Œ Refresh æŒ‰éˆ•å„å‡ºç¾å…©å€‹åœ–ç¤ºã€‚åŸä½œè€…ç¶²ç«™ (raz0red.github.io/js7800/) åªæœ‰å„ä¸€å€‹ã€‚

#### åŸå› åˆ†æ
- HTML ä¸­å·²å®šç¾©äº†æŒ‰éˆ•çš„ `<img>` æ¨™ç±¤ï¼ˆbase64 ç·¨ç¢¼ï¼‰
- JS çš„ `start()` å‡½æ•¸åˆé‡è¤‡å‰µå»ºä¸¦æ·»åŠ  `<img>` å…ƒç´ 
- å°è‡´æ¯å€‹æŒ‰éˆ•é¡¯ç¤ºå…©å€‹åœ–ç¤º

#### è§£æ±ºæ–¹æ¡ˆ
**æª”æ¡ˆ**: `site/leaderboard/src/js/leaderboard.js`

ç§»é™¤ `start()` å‡½æ•¸ä¸­é‡è¤‡æ·»åŠ åœ–ç‰‡çš„ä»£ç¢¼ï¼š

```javascript
// ä¿®æ”¹å‰ï¼šæœƒå‰µå»ºæ–°çš„ img å…ƒç´ 
var img = document.createElement("img");  
img.className = "button-image";
img.src = restartImgSrc;
img.setAttribute("title", "Refresh");
restartEl.appendChild(img);

// ä¿®æ”¹å¾Œï¼šåªè¨­ç½® onclick
var restartEl = document.getElementById("restart-button");
restartEl.onclick = function() {
  loadScores(currentDigest, currentFilter)
};
```

#### é©—è­‰
âœ… æ¯å€‹æŒ‰éˆ•åªé¡¯ç¤ºä¸€å€‹åœ–ç¤º
âœ… åŠŸèƒ½æ­£å¸¸é‹ä½œ

---

### å•é¡Œ 2: éŒ¯èª¤è¨Šæ¯æ”¹å–„ âœ…

#### å•é¡Œæè¿°
Global Leaderboard ç„¡æ³•è®€å–è³‡æ–™æ™‚ï¼Œåªé¡¯ç¤º `503: ` é€™æ¨£çš„ç°¡çŸ­è¨Šæ¯ï¼Œä¸å¤ å‹å–„ã€‚

#### æ”¹å–„ç›®æ¨™
æ”¹ç‚ºèˆ‡åŸä½œè€…ç›¸åŒçš„æ ¼å¼ï¼Œä¸¦åŠ ä¸Šå‹å–„æç¤ºï¼š
```
Error during read attempt: https://twitchasylum.com/x/scoreboard-games.php
(See console log for details)

Hint: Try refresh this page later.
```

#### è§£æ±ºæ–¹æ¡ˆ
**æª”æ¡ˆ**: `site/leaderboard/src/js/leaderboard.js`

ä¿®æ”¹ `read()` å‡½æ•¸çš„éŒ¯èª¤è™•ç†ï¼š

```javascript
// ä¿®æ”¹å‰
if (xhr.status >= 300 || xhr.status < 200) {
  throw xhr.status + ": " + xhr.statusText;  // åªé¡¯ç¤º "503: "
}

// ä¿®æ”¹å¾Œ
if (xhr.status >= 300 || xhr.status < 200) {
  // Convert HTTP error to user-friendly message
  throw 'Error during read attempt: ' + url + '<br>(See console log for details)<br><br>Hint: Try refresh this page later.';
}
// Also log the actual HTTP status to console
console.error('HTTP ' + xhr.status + ': ' + xhr.statusText);
```

#### æ”¹å–„å…§å®¹
1. **ä½¿ç”¨è€…çœ‹åˆ°å‹å–„è¨Šæ¯**: åŒ…å«å®Œæ•´ URL å’Œæç¤ºæŸ¥çœ‹ console
2. **é–‹ç™¼è€…å¯æŸ¥çœ‹è©³ç´°è³‡è¨Š**: Console è¨˜éŒ„å®Œæ•´çš„ HTTP ç‹€æ…‹ç¢¼
3. **æ ¼å¼èˆ‡åŸä½œè€…ä¸€è‡´**: ä½¿ç”¨ç›¸åŒçš„éŒ¯èª¤è¨Šæ¯æ ¼å¼
4. **å‹å–„æç¤º**: åŠ ä¸Š "Hint: Try refresh this page later." æç¤ºä½¿ç”¨è€…ç¨å¾Œé‡è©¦

#### é©—è­‰
âœ… 503 éŒ¯èª¤é¡¯ç¤ºå‹å–„è¨Šæ¯
âœ… Console è¨˜éŒ„å®Œæ•´ç‹€æ…‹ç¢¼
âœ… æ ¼å¼èˆ‡åŸä½œè€…ä¸€è‡´

---

## å¤šèªç³»æ”¯æ´ (2025-10-23)

### Global Leaderboard å¤šèªç³»å¯¦ä½œ âœ…

#### éœ€æ±‚
1. Global Leaderboard çš„èªç³»è¦èˆ‡ä¸»æ¨¡æ“¬å™¨åŒæ­¥
2. é¦–æ¬¡è¨ªå•æ™‚åƒè€ƒç€è¦½å™¨èªç³»
3. å¦‚æœä¸»æ¨¡æ“¬å™¨çš„ localStorage å·²æœ‰å®šç¾©èªç³»ï¼Œå‰‡ä»¥è©²èªç³»ç‚ºæº–

#### å¯¦ä½œæ–¹æ¡ˆ

##### 1. æ–°å¢ i18n æ¨¡çµ„
**æª”æ¡ˆ**: `site/leaderboard/src/js/i18n-leaderboard.js`

**åŠŸèƒ½**:
- å¾ localStorage è®€å– `locale` éµå€¼ï¼ˆèˆ‡ä¸»æ¨¡æ“¬å™¨å…±ç”¨ï¼‰
- å¦‚æœæ²’æœ‰å„²å­˜çš„èªç³»ï¼Œè‡ªå‹•åµæ¸¬ç€è¦½å™¨èªè¨€
- æ”¯æ´ä¸‰ç¨®èªè¨€ï¼šEnglish, ç¹é«”ä¸­æ–‡, ç®€ä½“ä¸­æ–‡

**èªç³»åµæ¸¬é †åº**:
1. localStorage çš„ `locale` éµå€¼ï¼ˆå„ªå…ˆï¼‰
2. ç€è¦½å™¨èªè¨€ (`navigator.language`)
3. é è¨­è‹±æ–‡

##### 2. ç¿»è­¯å…§å®¹

æ‰€æœ‰ UI æ–‡å­—éƒ½å·²ç¿»è­¯ï¼ŒåŒ…å«ï¼š

**éœæ…‹æ–‡å­—**:
- é é¢æ¨™é¡Œ "Global Leaderboard"
- å€å¡Šæ¨™é¡Œï¼ˆTop Players, Latest High Scores ç­‰ï¼‰
- éŠæˆ²é¸å–®æ¨™ç±¤ï¼ˆGame, Settingsï¼‰
- è¡¨æ ¼æ¬„ä½ï¼ˆPlayer, Score, Dateï¼‰
- æŒ‰éˆ•æç¤ºï¼ˆPlay, Refreshï¼‰

**å‹•æ…‹æ–‡å­—**:
- "points" (åˆ† / åˆ†)
- "scores" (ç­†åˆ†æ•¸ / ç¬”åˆ†æ•°)
- "players" (ä½ç©å®¶ / ä½ç©å®¶)
- "No scores currently exist" (æ­¤éŠæˆ²ç›®å‰ç„¡åˆ†æ•¸ç´€éŒ„)

**ç¿»è­¯å°ç…§è¡¨**:

| English | ç¹é«”ä¸­æ–‡ | ç®€ä½“ä¸­æ–‡ |
|---------|---------|---------|
| Global Leaderboard | å…¨åŸŸæ’è¡Œæ¦œ | å…¨å±€æ’è¡Œæ¦œ |
| Top Players | é ‚å°–ç©å®¶ | é¡¶å°–ç©å®¶ |
| Latest High Scores | æœ€æ–°é«˜åˆ†ç´€éŒ„ | æœ€æ–°é«˜åˆ†è®°å½• |
| Most Competitive Modes | æœ€å…·ç«¶çˆ­æ¨¡å¼ | æœ€å…·ç«äº‰æ¨¡å¼ |
| Game | éŠæˆ² | æ¸¸æˆ |
| Settings | è¨­å®š | è®¾ç½® |
| Player | ç©å®¶ | ç©å®¶ |
| Score | åˆ†æ•¸ | åˆ†æ•° |
| Date | æ—¥æœŸ | æ—¥æœŸ |
| points | åˆ† | åˆ† |
| scores | ç­†åˆ†æ•¸ | ç¬”åˆ†æ•° |
| players | ä½ç©å®¶ | ä½ç©å®¶ |
| Refresh | é‡æ–°æ•´ç† | åˆ·æ–° |
| Play | é–‹å§‹éŠæˆ² | å¼€å§‹æ¸¸æˆ |

##### 3. æ•´åˆåˆ° Leaderboard

**ä¿®æ”¹æª”æ¡ˆ**:
- `site/leaderboard/src/js/leaderboard.js` - å¼•å…¥ i18n ä¸¦æ›´æ–°æ‰€æœ‰æ–‡å­—
- `site/leaderboard/index.html` - ç‚ºå…ƒç´ æ·»åŠ  ID ä»¥æ”¯æ´å‹•æ…‹ç¿»è­¯

**å¯¦ä½œç´°ç¯€**:
```javascript
// åœ¨ start() å‡½æ•¸é–‹å§‹æ™‚åˆå§‹åŒ–
I18n.init();  // è‡ªå‹•åŒæ­¥ä¸»æ¨¡æ“¬å™¨èªç³»

// æ›´æ–°éœæ…‹ UI æ–‡å­—
document.getElementById('header-title').innerHTML = I18n.t('title');
document.getElementById('page-description').textContent = I18n.t('description');
// ... å…¶ä»–å…ƒç´ 

// å‹•æ…‹ç”Ÿæˆçš„æ–‡å­—ä¹Ÿä½¿ç”¨ i18n
points.appendChild(document.createTextNode(
  score + " " + I18n.t('points')
));
```

#### é©—è­‰
âœ… èªç³»èˆ‡ä¸»æ¨¡æ“¬å™¨åŒæ­¥
âœ… ç€è¦½å™¨èªç³»è‡ªå‹•åµæ¸¬
âœ… æ‰€æœ‰æ–‡å­—æ­£ç¢ºç¿»è­¯
âœ… å‹•æ…‹å…§å®¹æ­£ç¢ºé¡¯ç¤º

---

### æ¨¡æ“¬å™¨é¦–é æ–‡å­—æ›´æ–° âœ…

#### éœ€æ±‚
é¦–é èªªæ˜æ–‡å­—å¾ "view current keyboard mappings" æ”¹ç‚º "change keyboard mappings & languages"

#### ä¿®æ”¹å…§å®¹
**æª”æ¡ˆ**: `src/js/common/i18n.js`

| èªè¨€ | ä¿®æ”¹å‰ | ä¿®æ”¹å¾Œ |
|------|--------|--------|
| EN | to view current keyboard mappings | to **change keyboard mappings & languages** |
| ZH-TW | ä»¥æª¢è¦–ç›®å‰éµç›¤å°æ‡‰ | ä»¥**è®Šæ›´éµç›¤å°æ‡‰èˆ‡èªè¨€** |
| ZH-CN | ä»¥æŸ¥çœ‹å½“å‰é”®ä½æ˜ å°„ | ä»¥**å˜æ›´é”®ä½æ˜ å°„ä¸è¯­è¨€** |

#### é©—è­‰
âœ… ä¸‰ç¨®èªè¨€éƒ½å·²æ›´æ–°
âœ… æ–‡å­—æ›´æº–ç¢ºåæ˜ åŠŸèƒ½

---

## æŠ€è¡“ç´°ç¯€

### ä¿®æ”¹æª”æ¡ˆæ¸…å–®

#### Leaderboard æ”¹é€²
1. `site/leaderboard/src/js/leaderboard.js`
   - ç§»é™¤é‡è¤‡æŒ‰éˆ•åœ–ç‰‡æ·»åŠ 
   - æ”¹å–„éŒ¯èª¤è¨Šæ¯è™•ç†
   - æ•´åˆ i18n æ¨¡çµ„
   - æ›´æ–°æ‰€æœ‰æ–‡å­—ä½¿ç”¨ç¿»è­¯å‡½æ•¸

2. `site/leaderboard/src/js/i18n-leaderboard.js` (æ–°å¢)
   - å®Œæ•´çš„ i18n æ¨¡çµ„
   - ä¸‰ç¨®èªè¨€ç¿»è­¯
   - localStorage åŒæ­¥é‚è¼¯

3. `site/leaderboard/index.html`
   - ç‚ºå¯ç¿»è­¯å…ƒç´ æ·»åŠ  ID

#### ä¸»æ¨¡æ“¬å™¨æ”¹é€²
4. `src/js/common/i18n.js`
   - æ›´æ–°é¦–é èªªæ˜æ–‡å­—ï¼ˆä¸‰ç¨®èªè¨€ï¼‰

### æ¸¬è©¦é …ç›®

#### Leaderboard æ¸¬è©¦
- [x] æŒ‰éˆ•åªé¡¯ç¤ºä¸€å€‹åœ–ç¤º
- [x] éŒ¯èª¤è¨Šæ¯æ ¼å¼æ­£ç¢º
- [x] èªç³»èˆ‡ä¸»æ¨¡æ“¬å™¨åŒæ­¥
- [x] ç€è¦½å™¨èªç³»è‡ªå‹•åµæ¸¬
- [x] æ‰€æœ‰æ–‡å­—æ­£ç¢ºç¿»è­¯
- [x] å‹•æ…‹æ–‡å­—æ­£ç¢ºé¡¯ç¤º

#### ä¸»æ¨¡æ“¬å™¨æ¸¬è©¦
- [x] é¦–é æ–‡å­—æ­£ç¢ºæ›´æ–°
- [x] ä¸‰ç¨®èªè¨€éƒ½æ­£ç¢ºé¡¯ç¤º

---

## ä¸‹ä¸€æ­¥è¨ˆç•«

### å·²å®Œæˆ âœ…
1. âœ… Leaderboard åŒæ­¥å•é¡Œ
2. âœ… Global Leaderboard æŒ‰éˆ•é‡è¤‡ä¿®æ­£
3. âœ… éŒ¯èª¤è¨Šæ¯æ”¹å–„
4. âœ… Global Leaderboard å¤šèªç³»æ”¯æ´
5. âœ… ä¸»æ¨¡æ“¬å™¨é¦–é æ–‡å­—æ›´æ–°

### å¾…è©•ä¼° â³
6. â³ æ–°å¢ JAï¼ˆæ—¥æ–‡ï¼‰èˆ‡ KOï¼ˆéŸ“æ–‡ï¼‰èªç³»
   - é ä¼°å·¥ä½œé‡ï¼š9-14 å°æ™‚
   - éœ€è¦å°ˆæ¥­ç¿»è­¯æ”¯æ´
   - å¯åˆ†éšæ®µé€²è¡Œï¼š
     - éšæ®µ 1ï¼šUI æ–‡å­—ç¿»è­¯ï¼ˆ2-3 å°æ™‚ï¼‰
     - éšæ®µ 2ï¼šHelp æª”æ¡ˆç¿»è­¯ï¼ˆ4-6 å°æ™‚ï¼‰
     - éšæ®µ 3ï¼šREADME ç¿»è­¯ï¼ˆ1-2 å°æ™‚ï¼‰

### å¯é¸å„ªåŒ–
- èª¿æ•´ Worker å¿«å–åƒæ•¸ä»¥å„ªåŒ–æ•ˆèƒ½
- æ–°å¢ Cloudflare KV æŒä¹…å¿«å–
- ç›£æ§æ—¥èªŒä»¥é€²ä¸€æ­¥å„ªåŒ–å¿«å–ç­–ç•¥

---

## ç‰ˆæœ¬è³‡è¨Š

- **æœ€å¾Œæ›´æ–°**: 2025-10-23
- **Fork ä¾†æº**: [raz0red/js7800](https://github.com/raz0red/js7800)
- **éƒ¨ç½²ç¶²å€**: https://js7800.pages.dev
- **Worker ç¶²å€**: https://js7800-leaderboard-worker.johantw.workers.dev

---

## å‚™è¨»

- npm å’Œ git æ“ä½œç”±é–‹ç™¼è€…è‡ªè¡Œè™•ç†
- ä¿®æ”¹å®Œæˆå¾Œéœ€åŸ·è¡Œ `npm run build` é‡æ–°ç·¨è­¯
- æ‰€æœ‰ä¿®æ”¹éƒ½å·²ä¿æŒèˆ‡åŸä½œè€…ç¨‹å¼ç¢¼é¢¨æ ¼ä¸€è‡´
