
let current = "en";
let pendingReload = false;

const locales = {
  en: {
    // Common
    common: {
      ok: "OK",
      cancel: "Cancel",
      defaults: "Defaults",
      defaultsTitle: "Reset to Defaults",
      close: "Close",
      settings: "Settings",
      help: "Help",
      loading: "Loading...",
      loadedCartList: "Succesfully loaded cartridge list.",
    },
    // Controls bar
    cbar: {
      pause: "Pause",
      resume: "Resume",
      soundOff: "Sound Off",
      soundOn: "Sound On",
      restart: "Restart",
      selectText: "SELECT",
      selectTooltip: "Select",
      resetText: "RESET",
      resetTooltip: "Reset",
      leftDiff: "Left difficulty switch",
      rightDiff: "Right difficulty switch",
      leaderboard: "Leaderboard",
      help: "Help / Info",
      settings: "Settings",
      fullscreen: "Fullscreen",
      exitFullscreen: "Exit Fullscreen",
    },
    // Site description
    site: {
      desc_settings: "Click<IMG/> <SPAN/> to view current keyboard mappings.",
      desc_help: "Click<IMG/> <SPAN/> for detailed usage instructions.",
      desc_load: "Load a cartridge using the drop-down menu or buttons below (you can also drag and drop a local file or remote file link onto the emulator).",
    },
    // Settings Dialog
    settings: {
      title: "Settings",
      tab: {
        display: "Display",
        keyboard: "Keyboard",
        gamepads: "Gamepads",
        highscores: "High Scores",
        advanced: "Advanced",
        language: "Language",
      },
      display: {
        title: "Display Settings",
        desc: "The following settings are used to control the screen display.",
        screenSize: "Screen size:",
        aspectRatio: "Aspect ratio:",
        ar_pp: "Pixel perfect (1:1 PAR)",
        ar_7800: "Atari 7800 (6:7 PAR)",
        ar_16x9: "Widescreen (16:9)",
        ar_ultra: "Ultra-widescreen (2.37:1)",
        fullscreen: "Fullscreen:",
        fs_fill: "Fill screen",
        fs_integer: "Integer scaling (height)",
        palette: "Palette:",
        filter: "Apply filter:",
      },
      gamepads: {
        title: "Gamepad Compatibility",
        desc1: "This page provides the ability to <b class=\"callout\">test compatibility</b> with connected gamepads.",
        // desc2 intentionally minimal
        gamepad: "Gamepad:",
        mapping: "Mapping:",
        consoleButtons: "Console Buttons",
      },
      keyboard: {
        title: "Keyboard Mappings",
        tip1: "Click on the <b class=\"callout\">red box</b> near a control to select it for mapping.",
        tip2: "Once selected, press the <b class=\"callout\">key</b> you would like to map to the control.",
        controller1: "Controller 1",
        controller2: "Controller 2",
      },
      highscores: {
        title: "High Score Settings",
        desc: "The following settings control high score persistence.",
        pending: "Changes will not take effect until the next game is loaded.",
        saveScores: "Save scores:",
        saveLocation: "Save location:",
        local: "Local (this device only)",
        global: "Global (worldwide leaderboard)",
        localFallback: "Local fallback:",
        localFallbackLabel: "Local Fallback",
      },
      advanced: {
        title: "Advanced",
        desc: "The following settings provide the ability to configure advanced features.",
        xm: "Expansion module (XM):",
        xm_auto: "(Automatic)",
        xm_enabled: "Enabled",
        xm_disabled: "Disabled",
        frameSkip: "Frame skipping:",
        none: "(None)",
        low: "Low",
        medium: "Medium (50%)",
        high: "High",
        vsync: "Vertical sync:",
        vsyncLabel: "Vertical Sync",
      },
      language: {
        title: "Language",
        label: "Language:",
        en: "English",
        zhTW: "繁體中文",
        zhCN: "简体中文",
        ja: "日本語",
        ko: "한국어",
        de: "Deutsch",
        es: "Español",
        fr: "Français",
        it: "Italiano",
        pt: "Português",
        ru: "Русский",
        noteReload: "Language change will reload the page.",
      }
    },
    // Help dialog
    help: {
      title: "Help",
      tabs: {
        about: "About",
        overview: "Overview",
        carts: "Cartridges",
        cbar: "Controls Bar",
        settings: "Settings Dialog",
        highscores: "High Scores",
      }
    }
  },
  "zh-TW": {
    common: {
      ok: "確定",
      cancel: "取消",
      defaults: "預設值",
      defaultsTitle: "重設為預設值",
      close: "關閉",
      settings: "設定",
      help: "說明",
      loading: "載入中...",
      loadedCartList: "已成功載入卡帶清單。",
    },
    cbar: {
      pause: "暫停",
      resume: "繼續",
      soundOff: "關閉聲音",
      soundOn: "開啟聲音",
      restart: "重新啟動",
      selectText: "SELECT",
      selectTooltip: "選擇",
      resetText: "RESET",
      resetTooltip: "重設",
      leftDiff: "左難度切換",
      rightDiff: "右難度切換",
      leaderboard: "排行榜",
      help: "說明 / 資訊",
      settings: "設定",
      fullscreen: "全螢幕",
      exitFullscreen: "離開全螢幕",
    },
    site: {
      desc_settings: "點擊<IMG/> <SPAN/> 以檢視目前鍵盤對應。",
      desc_help: "點擊<IMG/> <SPAN/> 以取得詳細使用說明。",
      desc_load: "使用下拉選單或下方按鈕載入卡帶（也可拖曳本機檔案或遠端連結到模擬器）。",
    },
    settings: {
      title: "設定",
      tab: {
        display: "顯示",
        keyboard: "鍵盤",
        gamepads: "手把",
        highscores: "高分",
        advanced: "進階",
        language: "語言",
      },
      display: {
        title: "顯示設定",
        desc: "以下設定用於控制畫面顯示。",
        screenSize: "畫面大小:",
        aspectRatio: "長寬比:",
        ar_pp: "像素等比 (1:1 PAR)",
        ar_7800: "Atari 7800 (6:7 PAR)",
        ar_16x9: "寬螢幕 (16:9)",
        ar_ultra: "超寬螢幕 (2.37:1)",
        fullscreen: "全螢幕:",
        fs_fill: "填滿螢幕",
        fs_integer: "整數縮放（高度）",
        palette: "調色盤:",
        filter: "套用濾鏡:",
      },
      gamepads: {
        title: "手把相容性",
        desc1: "此頁可用來<b class=\"callout\">測試</b>已連線手把的相容性。",
        gamepad: "手把:",
        mapping: "對應:",
        consoleButtons: "主機按鈕",
      },
      keyboard: {
        title: "鍵盤對應",
        tip1: "點選控制項旁的<b class=\"callout\">紅框</b>以選取要設定的對應。",
        tip2: "選取後，按下要對應的<b class=\"callout\">按鍵</b>。",
        controller1: "控制器 1",
        controller2: "控制器 2",
      },
      highscores: {
        title: "高分設定",
        desc: "以下設定用於控制高分紀錄保存。",
        pending: "變更將在下次載入遊戲後生效。",
        saveScores: "儲存分數:",
        saveLocation: "儲存位置:",
        local: "本機（僅此裝置）",
        global: "全域（世界排行榜）",
        localFallback: "本機備援:",
        localFallbackLabel: "本機備援",
      },
      advanced: {
        title: "進階",
        desc: "以下設定可調整進階功能。",
        xm: "擴充模組（XM）:",
        xm_auto: "（自動）",
        xm_enabled: "啟用",
        xm_disabled: "停用",
        frameSkip: "跳幀:",
        none: "（無）",
        low: "低",
        medium: "中（50%）",
        high: "高",
        vsync: "垂直同步:",
        vsyncLabel: "垂直同步",
      },
      language: {
        title: "語言",
        label: "語言:",
        en: "English",
        zhTW: "繁體中文",
        zhCN: "简体中文",
        noteReload: "切換語言將重新載入頁面。",
      }
    },
    help: {
      title: "說明",
      tabs: {
        about: "關於",
        overview: "總覽",
        carts: "卡帶",
        cbar: "控制列",
        settings: "設定對話框",
        highscores: "高分",
      }
    }
  },
  "zh-CN": {
    common: {
      ok: "确定",
      cancel: "取消",
      defaults: "默认值",
      defaultsTitle: "重置为默认值",
      close: "关闭",
      settings: "设置",
      help: "帮助",
      loading: "加载中...",
      loadedCartList: "已成功载入卡带清单。",
    },
    cbar: {
      pause: "暂停",
      resume: "继续",
      soundOff: "关闭声音",
      soundOn: "打开声音",
      restart: "重新启动",
      selectText: "SELECT",
      selectTooltip: "选择",
      resetText: "RESET",
      resetTooltip: "重置",
      leftDiff: "左难度切换",
      rightDiff: "右难度切换",
      leaderboard: "排行榜",
      help: "帮助 / 信息",
      settings: "设置",
      fullscreen: "全屏",
      exitFullscreen: "退出全屏",
    },
    site: {
      desc_settings: "点击<IMG/> <SPAN/> 以查看当前键位映射。",
      desc_help: "点击<IMG/> <SPAN/> 查看详细使用说明。",
      desc_load: "使用下拉菜单或下方按钮载入卡带（也可拖拽本地文件或远程链接到模拟器）。",
    },
    settings: {
      title: "设置",
      tab: {
        display: "显示",
        keyboard: "键盘",
        gamepads: "手柄",
        highscores: "高分",
        advanced: "高级",
        language: "语言",
      },
      display: {
        title: "显示设置",
        desc: "以下设置用于控制屏幕显示。",
        screenSize: "屏幕大小:",
        aspectRatio: "纵横比:",
        ar_pp: "像素等比 (1:1 PAR)",
        ar_7800: "Atari 7800 (6:7 PAR)",
        ar_16x9: "宽屏 (16:9)",
        ar_ultra: "超宽屏 (2.37:1)",
        fullscreen: "全屏:",
        fs_fill: "填满屏幕",
        fs_integer: "整数缩放（高度）",
        palette: "调色板:",
        filter: "应用滤镜:",
      },
      gamepads: {
        title: "手柄兼容性",
        desc1: "此页可用于<b class=\"callout\">测试</b>已连接手柄的兼容性。",
        gamepad: "手柄:",
        mapping: "映射:",
        consoleButtons: "主机按钮",
      },
      keyboard: {
        title: "键盘映射",
        tip1: "点击控制项旁的<b class=\"callout\">红框</b>以选择要设置的映射。",
        tip2: "选择后，按下要映射的<b class=\"callout\">按键</b>。",
        controller1: "控制器 1",
        controller2: "控制器 2",
      },
      highscores: {
        title: "高分设置",
        desc: "以下设置用于控制高分记录保存。",
        pending: "更改将在下次载入游戏后生效。",
        saveScores: "保存分数:",
        saveLocation: "保存位置:",
        local: "本机（仅此设备）",
        global: "全局（世界排行榜）",
        localFallback: "本机回退:",
        localFallbackLabel: "本机回退",
      },
      advanced: {
        title: "高级",
        desc: "以下设置可调整高级功能。",
        xm: "扩展模块（XM）:",
        xm_auto: "（自动）",
        xm_enabled: "启用",
        xm_disabled: "停用",
        frameSkip: "跳帧:",
        none: "（无）",
        low: "低",
        medium: "中（50%）",
        high: "高",
        vsync: "垂直同步:",
        vsyncLabel: "垂直同步",
      },
      language: {
        title: "语言",
        label: "语言:",
        en: "English",
        zhTW: "繁體中文",
        zhCN: "简体中文",
        noteReload: "切换语言将重新加载页面。",
      }
    },
    help: {
      title: "帮助",
      tabs: {
        about: "关于",
        overview: "总览",
        carts: "卡带",
        cbar: "控制栏",
        settings: "设置对话框",
        highscores: "高分",
      }
    }
  },
  ja: {
    common: {
      ok: "OK",
      cancel: "キャンセル",
      defaults: "デフォルト",
      defaultsTitle: "デフォルトにリセット",
      close: "閉じる",
      settings: "設定",
      help: "ヘルプ",
      loading: "読み込み中...",
      loadedCartList: "カートリッジリストを正常に読み込みました。",
    },
    cbar: {
      pause: "一時停止",
      resume: "再開",
      soundOff: "音声オフ",
      soundOn: "音声オン",
      restart: "再起動",
      selectText: "SELECT",
      selectTooltip: "選択",
      resetText: "RESET",
      resetTooltip: "リセット",
      leftDiff: "左難易度スイッチ",
      rightDiff: "右難易度スイッチ",
      leaderboard: "リーダーボード",
      help: "ヘルプ / 情報",
      settings: "設定",
      fullscreen: "フルスクリーン",
      exitFullscreen: "フルスクリーン終了",
    },
    site: {
      desc_settings: "<IMG/> <SPAN/> をクリックして現在のキーマッピングを表示します。",
      desc_help: "<IMG/> <SPAN/> をクリックして詳細な使用説明を表示します。",
      desc_load: "ドロップダウンメニューまたは下のボタンを使用してカートリッジを読み込みます（ローカルファイルやリモートファイルリンクをエミュレーターにドラッグアンドドロップすることもできます）。",
    },
    settings: {
      title: "設定",
      tab: {
        display: "ディスプレイ",
        keyboard: "キーボード",
        gamepads: "ゲームパッド",
        highscores: "ハイスコア",
        advanced: "詳細",
        language: "言語",
      },
      display: {
        title: "ディスプレイ設定",
        desc: "画面表示を制御するための設定です。",
        screenSize: "画面サイズ:",
        aspectRatio: "アスペクト比:",
        ar_pp: "ピクセルパーフェクト (1:1 PAR)",
        ar_7800: "Atari 7800 (6:7 PAR)",
        ar_16x9: "ワイドスクリーン (16:9)",
        ar_ultra: "ウルトラワイドスクリーン (2.37:1)",
        fullscreen: "フルスクリーン:",
        fs_fill: "画面いっぱい",
        fs_integer: "整数スケーリング（高さ）",
        palette: "パレット:",
        filter: "フィルター適用:",
      },
      gamepads: {
        title: "ゲームパッド互換性",
        desc1: "このページでは接続されたゲームパッドの<b class=\"callout\">互換性テスト</b>が可能です。",
        gamepad: "ゲームパッド:",
        mapping: "マッピング:",
        consoleButtons: "コンソールボタン",
      },
      keyboard: {
        title: "キーボードマッピング",
        tip1: "マッピングするコントロールの横にある<b class=\"callout\">赤いボックス</b>をクリックします。",
        tip2: "選択したら、マッピングしたい<b class=\"callout\">キー</b>を押します。",
        controller1: "コントローラー 1",
        controller2: "コントローラー 2",
      },
      highscores: {
        title: "ハイスコア設定",
        desc: "ハイスコアの保存を制御する設定です。",
        pending: "変更は次のゲームが読み込まれた後に有効になります。",
        saveScores: "スコア保存:",
        saveLocation: "保存場所:",
        local: "ローカル（このデバイスのみ）",
        global: "グローバル（世界ランキング）",
        localFallback: "ローカルフォールバック:",
        localFallbackLabel: "ローカルフォールバック",
      },
      advanced: {
        title: "詳細",
        desc: "詳細機能の設定が可能です。",
        xm: "拡張モジュール (XM):",
        xm_auto: "（自動）",
        xm_enabled: "有効",
        xm_disabled: "無効",
        frameSkip: "フレームスキップ:",
        none: "（なし）",
        low: "低",
        medium: "中（50%）",
        high: "高",
        vsync: "垂直同期:",
        vsyncLabel: "垂直同期",
      },
      language: {
        title: "言語",
        label: "言語:",
        en: "English",
        zhTW: "繁體中文",
        zhCN: "简体中文",
        ja: "日本語",
        ko: "한국어",
        de: "Deutsch",
        es: "Español",
        fr: "Français",
        it: "Italiano",
        pt: "Português",
        ru: "Русский",
        noteReload: "言語変更はページをリロードします。",
      }
    },
    help: {
      title: "ヘルプ",
      tabs: {
        about: "概要",
        overview: "概要",
        carts: "カートリッジ",
        cbar: "コントロールバー",
        settings: "設定ダイアログ",
        highscores: "ハイスコア",
      }
    }
  },
  ko: {
    common: {
      ok: "확인",
      cancel: "취소",
      defaults: "기본값",
      defaultsTitle: "기본값으로 재설정",
      close: "닫기",
      settings: "설정",
      help: "도움말",
      loading: "로딩 중...",
      loadedCartList: "카트리지 목록을 성공적으로 로드했습니다.",
    },
    cbar: {
      pause: "일시정지",
      resume: "재개",
      soundOff: "소리 끄기",
      soundOn: "소리 켜기",
      restart: "재시작",
      selectText: "SELECT",
      selectTooltip: "선택",
      resetText: "RESET",
      resetTooltip: "리셋",
      leftDiff: "왼쪽 난이도 스위치",
      rightDiff: "오른쪽 난이도 스위치",
      leaderboard: "리더보드",
      help: "도움말 / 정보",
      settings: "설정",
      fullscreen: "전체화면",
      exitFullscreen: "전체화면 종료",
    },
    site: {
      desc_settings: "<IMG/> <SPAN/>을 클릭하여 현재 키보드 매핑을 확인합니다.",
      desc_help: "<IMG/> <SPAN/>을 클릭하여 자세한 사용 설명을 확인합니다.",
      desc_load: "드롭다운 메뉴 또는 아래 버튼을 사용하여 카트리지를 로드합니다 (로컬 파일이나 원격 파일 링크를 에뮬레이터에 드래그 앤 드롭할 수도 있습니다).",
    },
    settings: {
      title: "설정",
      tab: {
        display: "디스플레이",
        keyboard: "키보드",
        gamepads: "게임패드",
        highscores: "하이스코어",
        advanced: "고급",
        language: "언어",
      },
      display: {
        title: "디스플레이 설정",
        desc: "화면 표시를 제어하는 설정입니다.",
        screenSize: "화면 크기:",
        aspectRatio: "화면 비율:",
        ar_pp: "픽셀 퍼펙트 (1:1 PAR)",
        ar_7800: "Atari 7800 (6:7 PAR)",
        ar_16x9: "와이드스크린 (16:9)",
        ar_ultra: "울트라 와이드스크린 (2.37:1)",
        fullscreen: "전체화면:",
        fs_fill: "화면 채우기",
        fs_integer: "정수 스케일링 (높이)",
        palette: "팔레트:",
        filter: "필터 적용:",
      },
      gamepads: {
        title: "게임패드 호환성",
        desc1: "이 페이지에서는 연결된 게임패드의 <b class=\"callout\">호환성 테스트</b>가 가능합니다.",
        gamepad: "게임패드:",
        mapping: "매핑:",
        consoleButtons: "콘솔 버튼",
      },
      keyboard: {
        title: "키보드 매핑",
        tip1: "매핑할 컨트롤 옆의 <b class=\"callout\">빨간 상자</b>를 클릭합니다.",
        tip2: "선택한 후, 매핑할 <b class=\"callout\">키</b>를 누릅니다.",
        controller1: "컨트롤러 1",
        controller2: "컨트롤러 2",
      },
      highscores: {
        title: "하이스코어 설정",
        desc: "하이스코어 저장을 제어하는 설정입니다.",
        pending: "변경사항은 다음 게임이 로드된 후에 적용됩니다.",
        saveScores: "점수 저장:",
        saveLocation: "저장 위치:",
        local: "로컬 (이 기기만)",
        global: "글로벌 (전세계 리더보드)",
        localFallback: "로컬 폴백:",
        localFallbackLabel: "로컬 폴백",
      },
      advanced: {
        title: "고급",
        desc: "고급 기능을 설정할 수 있습니다.",
        xm: "확장 모듈 (XM):",
        xm_auto: "(자동)",
        xm_enabled: "활성화",
        xm_disabled: "비활성화",
        frameSkip: "프레임 스킵:",
        none: "(없음)",
        low: "낮음",
        medium: "중간 (50%)",
        high: "높음",
        vsync: "수직 동기화:",
        vsyncLabel: "수직 동기화",
      },
      language: {
        title: "언어",
        label: "언어:",
        en: "English",
        zhTW: "繁體中文",
        zhCN: "简体中文",
        ja: "日本語",
        ko: "한국어",
        de: "Deutsch",
        es: "Español",
        fr: "Français",
        it: "Italiano",
        pt: "Português",
        ru: "Русский",
        noteReload: "언어 변경은 페이지를 새로고침합니다.",
      }
    },
    help: {
      title: "도움말",
      tabs: {
        about: "정보",
        overview: "개요",
        carts: "카트리지",
        cbar: "컨트롤 바",
        settings: "설정 대화상자",
        highscores: "하이스코어",
      }
    }
  },
  de: {
    common: {
      ok: "OK",
      cancel: "Abbrechen",
      defaults: "Standard",
      defaultsTitle: "Auf Standard zurücksetzen",
      close: "Schließen",
      settings: "Einstellungen",
      help: "Hilfe",
      loading: "Laden...",
      loadedCartList: "Cartridge-Liste erfolgreich geladen.",
    },
    cbar: {
      pause: "Pause",
      resume: "Fortsetzen",
      soundOff: "Ton aus",
      soundOn: "Ton an",
      restart: "Neustart",
      selectText: "SELECT",
      selectTooltip: "Auswählen",
      resetText: "RESET",
      resetTooltip: "Zurücksetzen",
      leftDiff: "Linker Schwierigkeitsgrad-Schalter",
      rightDiff: "Rechter Schwierigkeitsgrad-Schalter",
      leaderboard: "Bestenliste",
      help: "Hilfe / Info",
      settings: "Einstellungen",
      fullscreen: "Vollbild",
      exitFullscreen: "Vollbild beenden",
    },
    site: {
      desc_settings: "Klicken Sie auf <IMG/> <SPAN/>, um die aktuellen Tastaturzuordnungen anzuzeigen.",
      desc_help: "Klicken Sie auf <IMG/> <SPAN/>, um detaillierte Nutzungsanweisungen zu erhalten.",
      desc_load: "Laden Sie eine Cartridge über das Dropdown-Menü oder die Schaltflächen unten (Sie können auch eine lokale Datei oder einen Remote-Datei-Link auf den Emulator ziehen und ablegen).",
    },
    settings: {
      title: "Einstellungen",
      tab: {
        display: "Anzeige",
        keyboard: "Tastatur",
        gamepads: "Gamepads",
        highscores: "Highscores",
        advanced: "Erweitert",
        language: "Sprache",
      },
      display: {
        title: "Anzeigeeinstellungen",
        desc: "Die folgenden Einstellungen steuern die Bildschirmanzeige.",
        screenSize: "Bildschirmgröße:",
        aspectRatio: "Seitenverhältnis:",
        ar_pp: "Pixel-perfekt (1:1 PAR)",
        ar_7800: "Atari 7800 (6:7 PAR)",
        ar_16x9: "Breitbild (16:9)",
        ar_ultra: "Ultra-Breitbild (2.37:1)",
        fullscreen: "Vollbild:",
        fs_fill: "Bildschirm füllen",
        fs_integer: "Ganzzahlige Skalierung (Höhe)",
        palette: "Palette:",
        filter: "Filter anwenden:",
      },
      gamepads: {
        title: "Gamepad-Kompatibilität",
        desc1: "Auf dieser Seite können Sie die <b class=\"callout\">Kompatibilität</b> mit angeschlossenen Gamepads testen.",
        gamepad: "Gamepad:",
        mapping: "Zuordnung:",
        consoleButtons: "Konsolen-Tasten",
      },
      keyboard: {
        title: "Tastaturzuordnungen",
        tip1: "Klicken Sie auf das <b class=\"callout\">rote Feld</b> neben einer Steuerung, um sie zur Zuordnung auszuwählen.",
        tip2: "Sobald ausgewählt, drücken Sie die <b class=\"callout\">Taste</b>, die Sie der Steuerung zuordnen möchten.",
        controller1: "Controller 1",
        controller2: "Controller 2",
      },
      highscores: {
        title: "Highscore-Einstellungen",
        desc: "Die folgenden Einstellungen steuern die Highscore-Persistenz.",
        pending: "Änderungen werden erst wirksam, nachdem das nächste Spiel geladen wurde.",
        saveScores: "Scores speichern:",
        saveLocation: "Speicherort:",
        local: "Lokal (nur dieses Gerät)",
        global: "Global (weltweite Bestenliste)",
        localFallback: "Lokales Fallback:",
        localFallbackLabel: "Lokales Fallback",
      },
      advanced: {
        title: "Erweitert",
        desc: "Die folgenden Einstellungen ermöglichen die Konfiguration erweiterter Funktionen.",
        xm: "Erweiterungsmodul (XM):",
        xm_auto: "(Automatisch)",
        xm_enabled: "Aktiviert",
        xm_disabled: "Deaktiviert",
        frameSkip: "Frame-Skipping:",
        none: "(Keines)",
        low: "Niedrig",
        medium: "Mittel (50%)",
        high: "Hoch",
        vsync: "Vertikale Synchronisation:",
        vsyncLabel: "Vertikale Synchronisation",
      },
      language: {
        title: "Sprache",
        label: "Sprache:",
        en: "English",
        zhTW: "繁體中文",
        zhCN: "简体中文",
        ja: "日本語",
        ko: "한국어",
        de: "Deutsch",
        es: "Español",
        fr: "Français",
        it: "Italiano",
        pt: "Português",
        ru: "Русский",
        noteReload: "Sprachänderung lädt die Seite neu.",
      }
    },
    help: {
      title: "Hilfe",
      tabs: {
        about: "Über",
        overview: "Übersicht",
        carts: "Cartridges",
        cbar: "Steuerleiste",
        settings: "Einstellungsdialog",
        highscores: "Highscores",
      }
    }
  },
  es: {
    common: {
      ok: "OK",
      cancel: "Cancelar",
      defaults: "Por defecto",
      defaultsTitle: "Restablecer a valores por defecto",
      close: "Cerrar",
      settings: "Configuración",
      help: "Ayuda",
      loading: "Cargando...",
      loadedCartList: "Lista de cartuchos cargada exitosamente.",
    },
    cbar: {
      pause: "Pausar",
      resume: "Reanudar",
      soundOff: "Sonido apagado",
      soundOn: "Sonido encendido",
      restart: "Reiniciar",
      selectText: "SELECT",
      selectTooltip: "Seleccionar",
      resetText: "RESET",
      resetTooltip: "Restablecer",
      leftDiff: "Interruptor de dificultad izquierdo",
      rightDiff: "Interruptor de dificultad derecho",
      leaderboard: "Tabla de líderes",
      help: "Ayuda / Información",
      settings: "Configuración",
      fullscreen: "Pantalla completa",
      exitFullscreen: "Salir de pantalla completa",
    },
    site: {
      desc_settings: "Haga clic en <IMG/> <SPAN/> para ver los mapeos de teclado actuales.",
      desc_help: "Haga clic en <IMG/> <SPAN/> para obtener instrucciones de uso detalladas.",
      desc_load: "Cargue un cartucho usando el menú desplegable o los botones a continuación (también puede arrastrar y soltar un archivo local o un enlace de archivo remoto en el emulador).",
    },
    settings: {
      title: "Configuración",
      tab: {
        display: "Pantalla",
        keyboard: "Teclado",
        gamepads: "Gamepads",
        highscores: "Puntuaciones altas",
        advanced: "Avanzado",
        language: "Idioma",
      },
      display: {
        title: "Configuración de pantalla",
        desc: "La siguiente configuración se utiliza para controlar la pantalla.",
        screenSize: "Tamaño de pantalla:",
        aspectRatio: "Relación de aspecto:",
        ar_pp: "Pixel perfecto (1:1 PAR)",
        ar_7800: "Atari 7800 (6:7 PAR)",
        ar_16x9: "Pantalla ancha (16:9)",
        ar_ultra: "Ultra pantalla ancha (2.37:1)",
        fullscreen: "Pantalla completa:",
        fs_fill: "Llenar pantalla",
        fs_integer: "Escalado entero (altura)",
        palette: "Paleta:",
        filter: "Aplicar filtro:",
      },
      gamepads: {
        title: "Compatibilidad con gamepad",
        desc1: "Esta página proporciona la capacidad de <b class=\"callout\">probar la compatibilidad</b> con gamepads conectados.",
        gamepad: "Gamepad:",
        mapping: "Mapeo:",
        consoleButtons: "Botones de consola",
      },
      keyboard: {
        title: "Mapeos de teclado",
        tip1: "Haga clic en la <b class=\"callout\">caja roja</b> junto a un control para seleccionarlo para el mapeo.",
        tip2: "Una vez seleccionado, presione la <b class=\"callout\">tecla</b> que desea asignar al control.",
        controller1: "Controlador 1",
        controller2: "Controlador 2",
      },
      highscores: {
        title: "Configuración de puntuaciones altas",
        desc: "La siguiente configuración controla la persistencia de puntuaciones altas.",
        pending: "Los cambios no tendrán efecto hasta que se cargue el próximo juego.",
        saveScores: "Guardar puntuaciones:",
        saveLocation: "Ubicación de guardado:",
        local: "Local (solo este dispositivo)",
        global: "Global (tabla de líderes mundial)",
        localFallback: "Reserva local:",
        localFallbackLabel: "Reserva local",
      },
      advanced: {
        title: "Avanzado",
        desc: "La siguiente configuración proporciona la capacidad de configurar características avanzadas.",
        xm: "Módulo de expansión (XM):",
        xm_auto: "(Automático)",
        xm_enabled: "Habilitado",
        xm_disabled: "Deshabilitado",
        frameSkip: "Omitir fotogramas:",
        none: "(Ninguno)",
        low: "Bajo",
        medium: "Medio (50%)",
        high: "Alto",
        vsync: "Sincronización vertical:",
        vsyncLabel: "Sincronización vertical",
      },
      language: {
        title: "Idioma",
        label: "Idioma:",
        en: "English",
        zhTW: "繁體中文",
        zhCN: "简体中文",
        ja: "日本語",
        ko: "한국어",
        de: "Deutsch",
        es: "Español",
        fr: "Français",
        it: "Italiano",
        pt: "Português",
        ru: "Русский",
        noteReload: "El cambio de idioma recargará la página.",
      }
    },
    help: {
      title: "Ayuda",
      tabs: {
        about: "Acerca de",
        overview: "Resumen",
        carts: "Cartuchos",
        cbar: "Barra de controles",
        settings: "Diálogo de configuración",
        highscores: "Puntuaciones altas",
      }
    }
  },
  fr: {
    common: {
      ok: "OK",
      cancel: "Annuler",
      defaults: "Par défaut",
      defaultsTitle: "Réinitialiser aux valeurs par défaut",
      close: "Fermer",
      settings: "Paramètres",
      help: "Aide",
      loading: "Chargement...",
      loadedCartList: "Liste de cartouches chargée avec succès.",
    },
    cbar: {
      pause: "Pause",
      resume: "Reprendre",
      soundOff: "Son désactivé",
      soundOn: "Son activé",
      restart: "Redémarrer",
      selectText: "SELECT",
      selectTooltip: "Sélectionner",
      resetText: "RESET",
      resetTooltip: "Réinitialiser",
      leftDiff: "Interrupteur de difficulté gauche",
      rightDiff: "Interrupteur de difficulté droite",
      leaderboard: "Classement",
      help: "Aide / Information",
      settings: "Paramètres",
      fullscreen: "Plein écran",
      exitFullscreen: "Quitter le plein écran",
    },
    site: {
      desc_settings: "Cliquez sur <IMG/> <SPAN/> pour voir les mappages de clavier actuels.",
      desc_help: "Cliquez sur <IMG/> <SPAN/> pour obtenir des instructions d'utilisation détaillées.",
      desc_load: "Chargez une cartouche en utilisant le menu déroulant ou les boutons ci-dessous (vous pouvez aussi faire glisser et déposer un fichier local ou un lien de fichier distant sur l'émulateur).",
    },
    settings: {
      title: "Paramètres",
      tab: {
        display: "Affichage",
        keyboard: "Clavier",
        gamepads: "Gamepads",
        highscores: "Meilleurs scores",
        advanced: "Avancé",
        language: "Langue",
      },
      display: {
        title: "Paramètres d'affichage",
        desc: "Les paramètres suivants sont utilisés pour contrôler l'affichage à l'écran.",
        screenSize: "Taille d'écran:",
        aspectRatio: "Rapport d'aspect:",
        ar_pp: "Pixel parfait (1:1 PAR)",
        ar_7800: "Atari 7800 (6:7 PAR)",
        ar_16x9: "Écran large (16:9)",
        ar_ultra: "Ultra-écran large (2.37:1)",
        fullscreen: "Plein écran:",
        fs_fill: "Remplir l'écran",
        fs_integer: "Mise à l'échelle entière (hauteur)",
        palette: "Palette:",
        filter: "Appliquer un filtre:",
      },
      gamepads: {
        title: "Compatibilité gamepad",
        desc1: "Cette page fournit la possibilité de <b class=\"callout\">tester la compatibilité</b> avec les gamepads connectés.",
        gamepad: "Gamepad:",
        mapping: "Mappage:",
        consoleButtons: "Boutons de console",
      },
      keyboard: {
        title: "Mappages clavier",
        tip1: "Cliquez sur la <b class=\"callout\">boîte rouge</b> à côté d'un contrôle pour le sélectionner pour le mappage.",
        tip2: "Une fois sélectionné, appuyez sur la <b class=\"callout\">touche</b> que vous souhaitez mapper au contrôle.",
        controller1: "Contrôleur 1",
        controller2: "Contrôleur 2",
      },
      highscores: {
        title: "Paramètres des meilleurs scores",
        desc: "Les paramètres suivants contrôlent la persistance des meilleurs scores.",
        pending: "Les changements ne prendront effet qu'après le chargement du prochain jeu.",
        saveScores: "Sauvegarder les scores:",
        saveLocation: "Emplacement de sauvegarde:",
        local: "Local (ce périphérique seulement)",
        global: "Global (classement mondial)",
        localFallback: "Secours local:",
        localFallbackLabel: "Secours local",
      },
      advanced: {
        title: "Avancé",
        desc: "Les paramètres suivants permettent de configurer des fonctionnalités avancées.",
        xm: "Module d'extension (XM):",
        xm_auto: "(Automatique)",
        xm_enabled: "Activé",
        xm_disabled: "Désactivé",
        frameSkip: "Saut d'images:",
        none: "(Aucun)",
        low: "Bas",
        medium: "Moyen (50%)",
        high: "Élevé",
        vsync: "Synchronisation verticale:",
        vsyncLabel: "Synchronisation verticale",
      },
      language: {
        title: "Langue",
        label: "Langue:",
        en: "English",
        zhTW: "繁體中文",
        zhCN: "简体中文",
        ja: "日本語",
        ko: "한국어",
        de: "Deutsch",
        es: "Español",
        fr: "Français",
        it: "Italiano",
        pt: "Português",
        ru: "Русский",
        noteReload: "Le changement de langue rechargera la page.",
      }
    },
    help: {
      title: "Aide",
      tabs: {
        about: "À propos",
        overview: "Aperçu",
        carts: "Cartouches",
        cbar: "Barre de contrôles",
        settings: "Dialogue des paramètres",
        highscores: "Meilleurs scores",
      }
    }
  },
  it: {
    common: {
      ok: "OK",
      cancel: "Annulla",
      defaults: "Predefiniti",
      defaultsTitle: "Ripristina predefiniti",
      close: "Chiudi",
      settings: "Impostazioni",
      help: "Aiuto",
      loading: "Caricamento...",
      loadedCartList: "Elenco cartucce caricato con successo.",
    },
    cbar: {
      pause: "Pausa",
      resume: "Riprendi",
      soundOff: "Audio disattivato",
      soundOn: "Audio attivato",
      restart: "Riavvia",
      selectText: "SELECT",
      selectTooltip: "Seleziona",
      resetText: "RESET",
      resetTooltip: "Ripristina",
      leftDiff: "Interruttore difficoltà sinistro",
      rightDiff: "Interruttore difficoltà destro",
      leaderboard: "Classifica",
      help: "Aiuto / Informazioni",
      settings: "Impostazioni",
      fullscreen: "Schermo intero",
      exitFullscreen: "Esci da schermo intero",
    },
    site: {
      desc_settings: "Clicca su <IMG/> <SPAN/> per visualizzare le mappature tastiera attuali.",
      desc_help: "Clicca su <IMG/> <SPAN/> per istruzioni d'uso dettagliate.",
      desc_load: "Carica una cartuccia usando il menu a discesa o i pulsanti qui sotto (puoi anche trascinare e rilasciare un file locale o un link di file remoto sull'emulatore).",
    },
    settings: {
      title: "Impostazioni",
      tab: {
        display: "Schermo",
        keyboard: "Tastiera",
        gamepads: "Gamepad",
        highscores: "Punteggi alti",
        advanced: "Avanzate",
        language: "Lingua",
      },
      display: {
        title: "Impostazioni schermo",
        desc: "Le seguenti impostazioni sono usate per controllare la visualizzazione.",
        screenSize: "Dimensione schermo:",
        aspectRatio: "Rapporto d'aspetto:",
        ar_pp: "Pixel perfetto (1:1 PAR)",
        ar_7800: "Atari 7800 (6:7 PAR)",
        ar_16x9: "Schermo largo (16:9)",
        ar_ultra: "Ultra schermo largo (2.37:1)",
        fullscreen: "Schermo intero:",
        fs_fill: "Riempi schermo",
        fs_integer: "Scalatura intera (altezza)",
        palette: "Tavolozza:",
        filter: "Applica filtro:",
      },
      gamepads: {
        title: "Compatibilità gamepad",
        desc1: "Questa pagina fornisce la capacità di <b class=\"callout\">testare la compatibilità</b> con i gamepad collegati.",
        gamepad: "Gamepad:",
        mapping: "Mappatura:",
        consoleButtons: "Pulsanti console",
      },
      keyboard: {
        title: "Mappature tastiera",
        tip1: "Clicca sulla <b class=\"callout\">casella rossa</b> accanto a un controllo per selezionarlo per la mappatura.",
        tip2: "Una volta selezionato, premi il <b class=\"callout\">tasto</b> che vuoi mappare al controllo.",
        controller1: "Controller 1",
        controller2: "Controller 2",
      },
      highscores: {
        title: "Impostazioni punteggi alti",
        desc: "Le seguenti impostazioni controllano la persistenza dei punteggi alti.",
        pending: "Le modifiche avranno effetto solo dopo il caricamento del prossimo gioco.",
        saveScores: "Salva punteggi:",
        saveLocation: "Posizione salvataggio:",
        local: "Locale (solo questo dispositivo)",
        global: "Globale (classifica mondiale)",
        localFallback: "Ripiego locale:",
        localFallbackLabel: "Ripiego locale",
      },
      advanced: {
        title: "Avanzate",
        desc: "Le seguenti impostazioni forniscono la capacità di configurare funzionalità avanzate.",
        xm: "Modulo espansione (XM):",
        xm_auto: "(Automatico)",
        xm_enabled: "Abilitato",
        xm_disabled: "Disabilitato",
        frameSkip: "Salto fotogrammi:",
        none: "(Nessuno)",
        low: "Basso",
        medium: "Medio (50%)",
        high: "Alto",
        vsync: "Sincronia verticale:",
        vsyncLabel: "Sincronia verticale",
      },
      language: {
        title: "Lingua",
        label: "Lingua:",
        en: "English",
        zhTW: "繁體中文",
        zhCN: "简体中文",
        ja: "日本語",
        ko: "한국어",
        de: "Deutsch",
        es: "Español",
        fr: "Français",
        it: "Italiano",
        pt: "Português",
        ru: "Русский",
        noteReload: "Il cambio lingua ricaricherà la pagina.",
      }
    },
    help: {
      title: "Aiuto",
      tabs: {
        about: "Informazioni",
        overview: "Panoramica",
        carts: "Cartucce",
        cbar: "Barra controlli",
        settings: "Dialogo impostazioni",
        highscores: "Punteggi alti",
      }
    }
  },
  pt: {
    common: {
      ok: "OK",
      cancel: "Cancelar",
      defaults: "Padrões",
      defaultsTitle: "Redefinir para padrões",
      close: "Fechar",
      settings: "Configurações",
      help: "Ajuda",
      loading: "Carregando...",
      loadedCartList: "Lista de cartuchos carregada com sucesso.",
    },
    cbar: {
      pause: "Pausar",
      resume: "Retomar",
      soundOff: "Som desligado",
      soundOn: "Som ligado",
      restart: "Reiniciar",
      selectText: "SELECT",
      selectTooltip: "Selecionar",
      resetText: "RESET",
      resetTooltip: "Redefinir",
      leftDiff: "Interruptor de dificuldade esquerdo",
      rightDiff: "Interruptor de dificuldade direito",
      leaderboard: "Tabela de líderes",
      help: "Ajuda / Informação",
      settings: "Configurações",
      fullscreen: "Tela cheia",
      exitFullscreen: "Sair da tela cheia",
    },
    site: {
      desc_settings: "Clique em <IMG/> <SPAN/> para ver os mapeamentos de teclado atuais.",
      desc_help: "Clique em <IMG/> <SPAN/> para instruções de uso detalhadas.",
      desc_load: "Carregue um cartucho usando o menu suspenso ou os botões abaixo (você também pode arrastar e soltar um arquivo local ou link de arquivo remoto no emulador).",
    },
    settings: {
      title: "Configurações",
      tab: {
        display: "Tela",
        keyboard: "Teclado",
        gamepads: "Gamepads",
        highscores: "Pontuações altas",
        advanced: "Avançado",
        language: "Idioma",
      },
      display: {
        title: "Configurações de tela",
        desc: "As seguintes configurações são usadas para controlar a exibição da tela.",
        screenSize: "Tamanho da tela:",
        aspectRatio: "Proporção da tela:",
        ar_pp: "Pixel perfeito (1:1 PAR)",
        ar_7800: "Atari 7800 (6:7 PAR)",
        ar_16x9: "Tela larga (16:9)",
        ar_ultra: "Ultra tela larga (2.37:1)",
        fullscreen: "Tela cheia:",
        fs_fill: "Preencher tela",
        fs_integer: "Escalagem inteira (altura)",
        palette: "Paleta:",
        filter: "Aplicar filtro:",
      },
      gamepads: {
        title: "Compatibilidade com gamepad",
        desc1: "Esta página fornece a capacidade de <b class=\"callout\">testar a compatibilidade</b> com gamepads conectados.",
        gamepad: "Gamepad:",
        mapping: "Mapeamento:",
        consoleButtons: "Botões do console",
      },
      keyboard: {
        title: "Mapeamentos de teclado",
        tip1: "Clique na <b class=\"callout\">caixa vermelha</b> ao lado de um controle para selecioná-lo para mapeamento.",
        tip2: "Uma vez selecionado, pressione a <b class=\"callout\">tecla</b> que você deseja mapear para o controle.",
        controller1: "Controlador 1",
        controller2: "Controlador 2",
      },
      highscores: {
        title: "Configurações de pontuações altas",
        desc: "As seguintes configurações controlam a persistência de pontuações altas.",
        pending: "As mudanças só terão efeito após o carregamento do próximo jogo.",
        saveScores: "Salvar pontuações:",
        saveLocation: "Local de salvamento:",
        local: "Local (apenas este dispositivo)",
        global: "Global (tabela de líderes mundial)",
        localFallback: "Retorno local:",
        localFallbackLabel: "Retorno local",
      },
      advanced: {
        title: "Avançado",
        desc: "As seguintes configurações fornecem a capacidade de configurar recursos avançados.",
        xm: "Módulo de expansão (XM):",
        xm_auto: "(Automático)",
        xm_enabled: "Habilitado",
        xm_disabled: "Desabilitado",
        frameSkip: "Pular quadros:",
        none: "(Nenhum)",
        low: "Baixo",
        medium: "Médio (50%)",
        high: "Alto",
        vsync: "Sincronização vertical:",
        vsyncLabel: "Sincronização vertical",
      },
      language: {
        title: "Idioma",
        label: "Idioma:",
        en: "English",
        zhTW: "繁體中文",
        zhCN: "简体中文",
        ja: "日本語",
        ko: "한국어",
        de: "Deutsch",
        es: "Español",
        fr: "Français",
        it: "Italiano",
        pt: "Português",
        ru: "Русский",
        noteReload: "A mudança de idioma recarregará a página.",
      }
    },
    help: {
      title: "Ajuda",
      tabs: {
        about: "Sobre",
        overview: "Visão geral",
        carts: "Cartuchos",
        cbar: "Barra de controles",
        settings: "Diálogo de configurações",
        highscores: "Pontuações altas",
      }
    }
  },
  ru: {
    common: {
      ok: "OK",
      cancel: "Отмена",
      defaults: "По умолчанию",
      defaultsTitle: "Сбросить к значениям по умолчанию",
      close: "Закрыть",
      settings: "Настройки",
      help: "Справка",
      loading: "Загрузка...",
      loadedCartList: "Список картриджей успешно загружен.",
    },
    cbar: {
      pause: "Пауза",
      resume: "Продолжить",
      soundOff: "Звук выключен",
      soundOn: "Звук включен",
      restart: "Перезапуск",
      selectText: "SELECT",
      selectTooltip: "Выбрать",
      resetText: "RESET",
      resetTooltip: "Сброс",
      leftDiff: "Левый переключатель сложности",
      rightDiff: "Правый переключатель сложности",
      leaderboard: "Таблица лидеров",
      help: "Справка / Информация",
      settings: "Настройки",
      fullscreen: "Полноэкранный режим",
      exitFullscreen: "Выйти из полноэкранного режима",
    },
    site: {
      desc_settings: "Нажмите <IMG/> <SPAN/>, чтобы просмотреть текущие сопоставления клавиатуры.",
      desc_help: "Нажмите <IMG/> <SPAN/>, чтобы получить подробные инструкции по использованию.",
      desc_load: "Загрузите картридж с помощью выпадающего меню или кнопок ниже (вы также можете перетащить локальный файл или ссылку на удаленный файл в эмулятор).",
    },
    settings: {
      title: "Настройки",
      tab: {
        display: "Экран",
        keyboard: "Клавиатура",
        gamepads: "Геймпады",
        highscores: "Рекорды",
        advanced: "Расширенные",
        language: "Язык",
      },
      display: {
        title: "Настройки экрана",
        desc: "Следующие настройки используются для управления экраном.",
        screenSize: "Размер экрана:",
        aspectRatio: "Соотношение сторон:",
        ar_pp: "Идеальные пиксели (1:1 PAR)",
        ar_7800: "Atari 7800 (6:7 PAR)",
        ar_16x9: "Широкоэкранный (16:9)",
        ar_ultra: "Ультра широкоэкранный (2.37:1)",
        fullscreen: "Полноэкранный режим:",
        fs_fill: "Заполнить экран",
        fs_integer: "Целочисленное масштабирование (высота)",
        palette: "Палитра:",
        filter: "Применить фильтр:",
      },
      gamepads: {
        title: "Совместимость с геймпадом",
        desc1: "Эта страница предоставляет возможность <b class=\"callout\">протестировать совместимость</b> с подключенными геймпадами.",
        gamepad: "Геймпад:",
        mapping: "Сопоставление:",
        consoleButtons: "Кнопки консоли",
      },
      keyboard: {
        title: "Сопоставления клавиатуры",
        tip1: "Нажмите на <b class=\"callout\">красное поле</b> рядом с элементом управления, чтобы выбрать его для сопоставления.",
        tip2: "После выбора нажмите <b class=\"callout\">клавишу</b>, которую вы хотите сопоставить с элементом управления.",
        controller1: "Контроллер 1",
        controller2: "Контроллер 2",
      },
      highscores: {
        title: "Настройки рекордов",
        desc: "Следующие настройки управляют сохранением рекордов.",
        pending: "Изменения вступят в силу только после загрузки следующей игры.",
        saveScores: "Сохранять баллы:",
        saveLocation: "Место сохранения:",
        local: "Локально (только это устройство)",
        global: "Глобально (мировая таблица лидеров)",
        localFallback: "Локальная резервная копия:",
        localFallbackLabel: "Локальная резервная копия",
      },
      advanced: {
        title: "Расширенные",
        desc: "Следующие настройки позволяют настраивать расширенные функции.",
        xm: "Модуль расширения (XM):",
        xm_auto: "(Автоматически)",
        xm_enabled: "Включено",
        xm_disabled: "Отключено",
        frameSkip: "Пропуск кадров:",
        none: "(Нет)",
        low: "Низкий",
        medium: "Средний (50%)",
        high: "Высокий",
        vsync: "Вертикальная синхронизация:",
        vsyncLabel: "Вертикальная синхронизация",
      },
      language: {
        title: "Язык",
        label: "Язык:",
        en: "English",
        zhTW: "繁體中文",
        zhCN: "简体中文",
        ja: "日本語",
        ko: "한국어",
        de: "Deutsch",
        es: "Español",
        fr: "Français",
        it: "Italiano",
        pt: "Português",
        ru: "Русский",
        noteReload: "Изменение языка перезагрузит страницу.",
      }
    },
    help: {
      title: "Справка",
      tabs: {
        about: "О программе",
        overview: "Обзор",
        carts: "Картриджи",
        cbar: "Панель управления",
        settings: "Диалог настроек",
        highscores: "Рекорды",
      }
    }
  }
};

function getLocale() {
  return current;
}

function t(key) {
  const parts = key.split('.')
  let obj = locales[current];
  for (const p of parts) {
    obj = obj && obj[p];
  }
  if (obj !== undefined) return obj;
  // fallback to en
  obj = locales.en;
  for (const p of parts) {
    obj = obj && obj[p];
  }
  return obj === undefined ? key : obj;
}

function setLocale(locale, reloadAfter = false) {
  current = locale;
  try { Storage.writeValue(LOCALE_KEY, locale, false); } catch (e) { }
  pendingReload = pendingReload || reloadAfter;
}

function needsReload() { return pendingReload; }

function init() {
  try {
    const stored = Storage.readValue(LOCALE_KEY, false);
    if (stored) current = stored;
  } catch (e) { }

  // If no stored setting, detect from browser language
  if (current === "en") {
    const lang = navigator.language.toLowerCase();
    if (lang === 'zh-tw' || lang === 'zh-hant') {
      current = 'zh-TW';
    } else if (lang.startsWith('zh')) {
      current = 'zh-CN';
    } else if (lang === 'ja') {
      current = 'ja';
    } else if (lang === 'ko') {
      current = 'ko';
    } else if (lang === 'de') {
      current = 'de';
    } else if (lang.startsWith('es')) {
      current = 'es';
    } else if (lang.startsWith('fr')) {
      current = 'fr';
    } else if (lang.startsWith('it')) {
      current = 'it';
    } else if (lang.startsWith('pt')) {
      current = 'pt';
    } else if (lang.startsWith('ru')) {
      current = 'ru';
    }
  }
}

export { t, init, setLocale, getLocale, needsReload }